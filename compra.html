<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8" />
    <link rel="stylesheet" href="estilo.css" />
    <title>Finalizar Compra</title>
</head>

<body>

    <header>
        <ul class="navigation">
            <li><a href="index.html">Voltar</a></li>
        </ul>
    </header>

    <div id="checkout" class="checkout">
        <h2>Finalizar Compra</h2>

        <div id="orderSummary"></div>

        <h3>Dados Pessoais</h3>
        <input id="nome" placeholder="Nome completo">
        <input id="email" placeholder="Email">
        <input id="telefone" placeholder="Telefone">

        <h3>Endereço</h3>
        <label>CEP:</label>
        <input id="cepInput" placeholder="Digite seu CEP">
        <button id="cepSearch">Buscar CEP</button>
        <p id="cepResult"></p>

        <input id="rua" placeholder="Rua">
        <input id="numero" placeholder="Número">
        <input id="bairro" placeholder="Bairro">
        <input id="cidade" placeholder="Cidade">
        <input id="estado" placeholder="Estado">

        <h3>Entrega</h3>
        <select id="entrega">
            <option value="normal">Frete Normal (5-9 dias)</option>
            <option value="expresso">Expresso (2-4 dias)</option>
            <option value="prioritario">Prioritário (1-2 dias)</option>
        </select>

        <h3>Taxas</h3>
        <button id="taxBtn">Calcular Taxas</button>
        <p id="taxResult"></p>

        <h3>Pagamento</h3>
        <button id="payBtn">Pagar via PIX</button>
        <p id="payResult"></p>

    </div>

    <script>
        // ============================
        // RESUMO DO PEDIDO
        // ============================
        const livros = {
            domquixote: { title: "Dom Quixote", price: "99.90" },
            hp1: { title: "Harry Potter 1", price: "59.90" },
            dorian: { title: "Dorian Gray", price: "49.90" }
        };

        const p = new URLSearchParams(location.search);
        const livro = livros[p.get("book")];

        document.getElementById("orderSummary").innerHTML = `
            <p>Livro: <strong>${livro.title}</strong></p>
            <p>Preço: <strong>R$ ${livro.price}</strong></p>
        `;

        // ============================
        // BUSCAR CEP
        // ============================
        document.getElementById("cepSearch").onclick = async () => {
            const cep = document.getElementById("cepInput").value;
            const r = await fetch(`https://brasilapi.com.br/api/cep/v2/${cep}`);
            const d = await r.json();

            document.getElementById("cepResult").innerHTML =
                `Endereço encontrado: ${d.street} - ${d.city}/${d.state}`;

            document.getElementById("rua").value = d.street;
            document.getElementById("bairro").value = d.neighborhood;
            document.getElementById("cidade").value = d.city;
            document.getElementById("estado").value = d.state;
        };

        // ============================
        // TAXAS
        // ============================
        document.getElementById("taxBtn").onclick = async () => {
            const r = await fetch("https://brasilapi.com.br/api/taxas/v1");
            const d = await r.json();

            document.getElementById("taxResult").innerHTML =
                `Taxa aplicada (${d[0].nome}): ${d[0].valor}%`;
        };

        // ============================
        // PAGAMENTO FAKE (PIX)
        // ============================
        document.getElementById("payBtn").onclick = async () => {

            const dados = {
                nome: document.getElementById("nome").value,
                email: document.getElementById("email").value,
                telefone: document.getElementById("telefone").value,
                endereco: {
                    rua: document.getElementById("rua").value,
                    numero: document.getElementById("numero").value,
                    bairro: document.getElementById("bairro").value,
                    cidade: document.getElementById("cidade").value,
                    estado: document.getElementById("estado").value
                },
                entrega: document.getElementById("entrega").value,
                livro: livro.title,
                preco: livro.price
            };

            const r = await fetch("https://jsonplaceholder.typicode.com/posts", {
                method: "POST",
                body: JSON.stringify(dados),
                headers: { "Content-Type": "application/json" }
            });

            const d = await r.json();

            document.getElementById("payResult").innerHTML =
                `Pagamento confirmado!<br>ID PIX: <strong>${d.id}</strong>`;
        };
    </script>

</body>

</html>
